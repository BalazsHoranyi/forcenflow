
{{- $inner := . -}}
{{- if or (eq $inner "") (eq $inner nil) -}}
    {{- $inner = "Empty brick found. Consider creating a 'content/bricks/features.md' file." -}}
    {{- with page.Site.GetPage "bricks/features.md" -}}
        {{- $inner = .RawContent -}}
    {{- end -}}
{{- end -}}
{{- $parts := split $inner "---" -}}
<section class="features">
    <div class="container small">
        {{- markdownify (index $parts 0) -}}
    </div>
    <div class="container">
        <ul class="grid features">
            {{ range after 1 $parts }}
                {{- $imageurl := index (split (index (findRE `(?s)src=".*?"` (markdownify .) 1) 0) `"`) 1 -}}
                {{- $type := "" -}}
                {{- if in $imageurl "/icons/" -}}{{- $type = "has_icon" -}}{{- end -}}
                {{- if in $imageurl "/illustrations/" -}}{{- $type = "has_illustration" -}}{{- end -}}
                <li class="{{ $type }}">
                {{ replace (markdownify .) `<p><img` `<p class="image"><img` | safeHTML }}
                </li>
            {{ end }}
        </ul>
    </div>
</section>


